---
import Base from '../../layouts/Base.astro';
---

<Base title="Schemas v0.1" description="JSON Schema definitions for MTF-compliant MCP server bundles. Validate MTF extensions and security scan reports.">
  <div class="container">
    <header class="page-header">
      <h1>JSON Schemas</h1>
      <p class="version">Version 0.1</p>
      <p class="intro">
        Machine-readable schemas for validating MTF security extensions
        and verification reports.
      </p>
    </header>

    <section class="schemas">
      <div class="schema-card">
        <div class="schema-header">
          <h2>mtf-extension.json</h2>
          <code class="schema-url">https://mpaktrust.org/schemas/v0.1/mtf-extension.json</code>
        </div>
        <p>
          MTF security extension schema for mcpb manifests. Validates the
          <code>_meta.org.mpaktrust</code> namespace including permissions,
          file hashes, signatures, and provenance fields.
        </p>
        <div class="schema-actions">
          <a href="/schemas/v0.1/mtf-extension.json" class="btn btn-primary" download>Download</a>
          <a href="/schemas/v0.1/mtf-extension.json" class="btn btn-secondary">View Raw</a>
        </div>
        <details class="schema-preview">
          <summary>Schema Preview</summary>
          <pre><code>{`{
  "$id": "https://mpaktrust.org/schemas/v0.1/mtf-extension.json",
  "required": ["mtf_version"],
  "properties": {
    "mtf_version": { "type": "string", "pattern": "^[0-9]+\\\\.[0-9]+$" },
    "level": { "type": "integer", "minimum": 1, "maximum": 4 },
    "permissions": { "filesystem", "network", "environment", "subprocess", "native" },
    "credentials": [{ "service", "scopes", "justification", "token_lifetime" }],
    "files": [{ "path", "sha256", "size" }],
    "source": { "commit", "signed" },
    "build": { "builder", "reproducible" },
    "signature": { "type", "bundle_path", "signer_identity" },
    "attestation": { "type", "bundle_path" }
  }
}`}</code></pre>
        </details>
      </div>

      <div class="schema-card">
        <div class="schema-header">
          <h2>report.json</h2>
          <code class="schema-url">https://mpaktrust.org/schemas/v0.1/report.json</code>
        </div>
        <p>
          Verification report format from MTF scanners. Includes compliance level,
          risk score, per-control results, and detailed findings with remediation.
        </p>
        <div class="schema-actions">
          <a href="/schemas/v0.1/report.json" class="btn btn-primary" download>Download</a>
          <a href="/schemas/v0.1/report.json" class="btn btn-secondary">View Raw</a>
        </div>
        <details class="schema-preview">
          <summary>Schema Preview</summary>
          <pre><code>{`{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://mpaktrust.org/schemas/v0.1/report.json",
  "properties": {
    "schemaVersion": { "const": "0.1.0" },
    "bundle": { ... },
    "compliance": {
      "level": 1-4,
      "level_name": "Basic|Standard|Verified|Attested"
    },
    "risk_score": "NONE|LOW|MEDIUM|HIGH|CRITICAL",
    "domains": { ... },
    "findings": [ ... ]
  }
}`}</code></pre>
        </details>
      </div>
    </section>

    <section class="usage">
      <h2>Usage</h2>
      <p>MTF extends mcpb manifests. Add the extension under <code>_meta.org.mpaktrust</code>:</p>
      <pre><code>{`{
  "manifest_version": "0.3",
  "name": "@myorg/my-mcp-server",
  "version": "1.0.0",
  ...
  "_meta": {
    "org.mpaktrust": {
      "mtf_version": "0.1",
      "level": 2,
      "permissions": { ... }
    }
  }
}`}</code></pre>

      <h3>Two-Step Validation</h3>
      <p>Validation is two-step: first validate the base manifest against the <a href="https://github.com/modelcontextprotocol/mcpb">mcpb schema</a>, then validate the MTF extension:</p>
      <pre><code>{`# Step 1: Validate against mcpb schema (ensures bundle can execute)
npx ajv validate -s ./mcpb-manifest-v0.4.schema.json -d manifest.json

# Step 2: Validate MTF extension (ensures security metadata is correct)
npx ajv validate -s https://mpaktrust.org/schemas/v0.1/mtf-extension.json -d manifest.json`}</code></pre>

      <p class="note">
        <strong>Note:</strong> VEX statements use the <a href="https://github.com/openvex/spec">OpenVEX specification</a>.
        MTF does not define a custom VEX schema.
      </p>
    </section>
  </div>

  <style>
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem;
    }

    .page-header {
      margin-bottom: 3rem;
    }

    .page-header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .version {
      display: inline-block;
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      font-family: var(--font-mono);
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }

    .intro {
      color: var(--color-text-muted);
      font-size: 1.125rem;
    }

    .schemas {
      display: flex;
      flex-direction: column;
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .schema-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: 8px;
      padding: 1.5rem;
    }

    .schema-header {
      margin-bottom: 1rem;
    }

    .schema-header h2 {
      font-size: 1.25rem;
      font-family: var(--font-mono);
      margin-bottom: 0.5rem;
    }

    .schema-url {
      font-size: 0.8rem;
      color: var(--color-text-muted);
      background: var(--color-bg);
      word-break: break-all;
    }

    .schema-card > p {
      color: var(--color-text-muted);
      margin-bottom: 1rem;
    }

    .schema-actions {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .btn {
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-weight: 500;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .btn:hover {
      text-decoration: none;
    }

    .btn-primary {
      background: var(--color-accent);
      color: white;
    }

    .btn-primary:hover {
      background: var(--color-accent-hover);
      color: white;
    }

    .btn-secondary {
      background: var(--color-bg);
      color: var(--color-text);
      border: 1px solid var(--color-border);
    }

    .btn-secondary:hover {
      border-color: var(--color-text-muted);
      color: var(--color-text);
    }

    .schema-preview {
      margin-top: 1rem;
    }

    .schema-preview summary {
      cursor: pointer;
      color: var(--color-text-muted);
      font-size: 0.875rem;
    }

    .schema-preview summary:hover {
      color: var(--color-text);
    }

    .schema-preview pre {
      margin-top: 1rem;
      font-size: 0.8rem;
    }

    .usage {
      border-top: 1px solid var(--color-border);
      padding-top: 2rem;
    }

    .usage h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .usage h3 {
      font-size: 1.125rem;
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
    }

    .usage p {
      color: var(--color-text-muted);
      margin-bottom: 0.75rem;
    }

    .usage pre {
      margin-bottom: 1.5rem;
    }

    .usage .note {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: 6px;
      padding: 1rem;
      font-size: 0.875rem;
    }

    .usage .note a {
      color: var(--color-accent);
    }
  </style>
</Base>
